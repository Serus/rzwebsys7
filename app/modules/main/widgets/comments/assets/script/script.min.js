(function(a){a.fn.commentsWidget=function(){return this.each(function(){var g=a(this);var d=g.find("textarea");var b=g.attr("id");var f=function(){g.find(".comments-ok").hide();g.find(".comments-error").show()};var e=function(i){g.find(".comments-ok").show();g.find(".comments-error").hide();var h="pjax-"+b;a(document).on("pjax:end",function(){c(i);a(document).off("pjax:end")});a.pjax.reload({container:"#"+h});d.val("");g.find(".comments-re-cancel").trigger("click")};var c=function(j){var h=a("#comments-item-"+j);if(h.length>0){var i=h.offset().top;a(window).scrollTop(i)}};a("body").on("click","#"+b+" .comments-re-link",function(){var i=a(this).data("id");var h=a(this).data("username");g.find("input[name='parent_id']").val(i);g.find(".comments-re-wrapper").show();g.find(".comments-re-info").html(h)});a("body").on("click","#"+b+" .comments-quote-link",function(){var i=a(this).data("id");var h=a(this).parents(".comments-item").find(".comments-body").text();d.markItUp("insert",{openWith:"[quote]",closeWith:"[/quote]",placeHolder:a.trim(h)})});g.find(".comments-re-cancel").on("click",function(h){g.find("input[name='parent_id']").val(0);g.find(".comments-re-wrapper").hide();g.find(".comments-re-info").html("");h.preventDefault()});g.find(".comments-add").on("click",function(k){k.preventDefault();var i=a(this).parents("form");var j=i.attr("action");var h=function(){i.find("input,select,textarea").each(function(){a(this).trigger("blur")})};a.ajax({url:j,type:"post",data:i.serialize(),headers:{},dataType:"json",success:function(m,l,n){if(n.status==201){e(m.id)}else{f()}},error:function(){h();f()}})})})}})(jQuery);